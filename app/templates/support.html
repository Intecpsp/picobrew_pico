<script src='static/js/showdown/showdown.min.js'></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        if ('{{support_object.manual_url}}' != 'None') {
            getPdf('https://docs.google.com/viewer?url={{support_object.manual_url}}&embedded=true', '#manualFrame');
        }
        if ('{{support_object.faq_url}}' != 'None') {
            getMarkdown('{{support_object.faq_url}}', 'faqDiv');
        }
        if ('{{support_object.instructional_videos_url}}' != 'None') {
            getMarkdown('{{support_object.instructional_videos_url}}', 'instructionalDiv');
        }
        if ('{{support_object.misc_media|tojson}}' != 'None') {
            var data = JSON.parse('{{support_object.misc_media|tojson}}');
            for (var key in data) {
                var frameKey = key.replace(/ /g, '_')
                var media = data[key]
                if (media.split('.').pop() == 'pdf') {
                    getPdf('https://docs.google.com/viewer?url='+media+'&embedded=true', '#'+frameKey);
                }
                if (media.split('.').pop() == 'md') {
                    getMarkdown(media, frameKey);
                }
            }
        }
    });

    function getPdf(url, outFrame) {
        $(outFrame).attr('src', url);
    }

    function getMarkdown(url, outDiv) {
        var storedText;

        fetch(url)
        .then(function(response) {
            response.text().then(function(text) {
            storedText = text;
            done();
            });
        });

        function done() {
            var text = storedText,
                target = document.getElementById(outDiv),
                converter = new showdown.Converter(),
                html = converter.makeHtml(text);

            target.innerHTML = html;
        }
    }
</script>
{% extends 'base.html' %}
{% block content %}
<div class='text-white'>
    <h2>{{support_object.name}}</h2>
    {% if support_object.manual_url != None %}
        <br />
        <hr />
        <h3>Manual</h3>
        <iframe id='manualFrame' style='width:100%; height:100%;' frameborder='0'></iframe>
    {% endif %}
    {% if support_object.faq_url != None %}
        <br />
        <hr />
        <div id='faqDiv'></div>
    {% endif %}
    {% if support_object.instructional_videos_url != None %}
        <br />
        <hr />
        <div id='instructionalDiv'></div>
    {% endif %}
    {% if support_object.misc_media != None %}
        <br />
        <hr />
        {% for key, segment in support_object.misc_media.items() %}
            <br />
            <hr />
            <h4>{{key}}</h4>
            {% if segment.split('.').pop() == 'pdf' %}
                <iframe id="{{key.replace(' ', '_')}}" style='width:100%; height:100%;' frameborder='0'></iframe>
            {% elif segment.split('.').pop() == 'md' %}
                <div id="{{key.replace(' ', '_')}}"></div>
            {% elif segment.split('.').pop() == 'png' %}
                <img src='{{segment}}'>
            {% elif 'com' in segment.split('.').pop() %}
                <div id="{{key.replace(' ', '_')}}"><a href='{{segment}}'>{{segment}}</a></div>
            {% endif %}
        {% endfor %}
    {% endif %}
</div>
{% endblock %}