<script src='/static/js/showdown/showdown.min.js'></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        if ('{{support_object.manual_path}}' != 'None') {
            getPdf('{{support_object.manual_path}}', '#manualFrame');
        }
        if ('{{support_object.faq_path}}' != 'None') {
            getMarkdown('{{support_object.faq_path}}', 'faqDiv');
        }
        if ('{{support_object.instructional_videos_path}}' != 'None') {
            getMarkdown('{{support_object.instructional_videos_path}}', 'instructionalDiv');
        }
        if ('{{support_object.misc_media|tojson}}' != 'None') {
            var data = JSON.parse('{{support_object.misc_media|tojson}}');
            for (var key in data) {
                var frameKey = key.replace(/ /g, '_')
                var media = data[key]
                if (media.split('.').pop() == 'pdf') {
                    getPdf(media, '#'+frameKey);
                }
                if (media.split('.').pop() == 'md') {
                    getMarkdown(media, frameKey);
                }
            }
        }
    });

    function getPdf(url, outFrame) {
        $(outFrame).attr('src', url);
    }

    function getMarkdown(url, outDiv) {
        var storedText;

        fetch(url)
        .then(function(response) {
            response.text().then(function(text) {
            storedText = text;
            done();
            });
        });

        function done() {
            var text = storedText,
                target = document.getElementById(outDiv),
                converter = new showdown.Converter(),
                html = converter.makeHtml(text);

            target.innerHTML = html;
        }
    }
</script>
{% extends 'base.html' %}
{% block content %}
<div class='text-white'>
    <h2>{{support_object.name}}</h2>

    <div class="container">
        {% if support_object.name == "KegSmarts" %}
        <div id=alert class='show w-75 mx-auto alert text-center alert-danger'>
            This device type is currently not supported by this server
        </div>
        {% endif %}
        <div id=alert class='show w-75 mx-auto alert text-center alert-warning'>
            All support documentation included in server at this time are direct copies from Picobrew.com in the off chance that Picobrew.com isn't available in the future. At a later time the server will come with its own documentation as well as community source device documentation.
        </div>
    </div>

    {% if support_object.manual_path != None %}
        <br />
        <hr />
        <h3>Manual</h3>
        <iframe id='manualFrame' style='width:100%; height:100%;' frameborder='0'></iframe>
    {% endif %}
    {% if support_object.faq_path != None %}
        <br />
        <hr />
        <div id='faqDiv'></div>
    {% endif %}
    {% if support_object.instructional_videos_path != None %}
        <br />
        <hr />
        <div id='instructionalDiv'></div>
    {% endif %}
    {% if support_object.misc_media != None %}
        <br />
        <hr />
        {% for key, segment in support_object.misc_media.items() %}
            <h4>{{key}}</h4>
            {% if segment.split('.').pop() == 'pdf' %}
                <iframe id="{{key.replace(' ', '_')}}" style='width:100%; height:100%;' frameborder='0'></iframe>
            {% elif segment.split('.').pop() == 'md' %}
                <div id="{{key.replace(' ', '_')}}"></div>
            {% elif segment.split('.').pop() == 'png' %}
                <img src='{{segment}}'>
            {% elif 'com' in segment.split('.').pop() %}
                <div id="{{key.replace(' ', '_')}}"><a href='{{segment}}'>{{segment}}</a></div>
            {% endif %}
            <br />
            <hr />
        {% endfor %}
    {% endif %}
</div>
{% endblock %}